<!DOCTYPE html>
<html>
<head>
    <script lang="javascript" src="js/jquery-3.1.0.min.js"></script>
    <script lang="javascript" src="js/d3.min.js"></script>
    <style>
        html, body {
            padding: 0;
            margin: 0;
        }
    </style>
</head>
<body>
    
    <script>
        var dimension = 500;

        var svg = d3.select('body').append('svg')
            .attr('width', dimension)
            .attr('height', dimension)
            .style('background-color', 'white');

        // YOUR CODE SHOULD START HERE
        /*
         * Name: Justin Jo
         * Word: Accumulate
         */

        var datalim = 1000;
        var ptdata = [];
        var tailData = [];
        var tailIndx = [];
		var srcRadius = dimension/28;
		var tailRadius = dimension/32;
        var sleep = 0;

        var cursor = svg.append("circle")
            .attr("id", "head")
            .attr("pointer-events", "none")
            .attr("r", 10)
            .attr("fill", "#fff")
            .attr("opacity", 0.5);

        function tick(pt) {
        	sleep = 0;
            // if (colordata.length == 0) { return; }
            // ptdata.unshift(pt);
            ptdata.push(pt);

            for (var i = 0; i < tailData.length; i++) {
            	tailIndx[i] = Math.max(tailIndx[i], ptdata.length - 5 * (i+1));
            	// tailIndx[i] = Math.min(tailIndx[i], ptdata.length - 5 * (i+1));
                tailData[i].attr('cx', ptdata[tailIndx[i]][0])
                    .attr('cy', ptdata[tailIndx[i]][1]);
            }

            if (ptdata.length > datalim) {
                ptdata.shift();
            }
        }

        function addColor(fill) {
            var new_circle = svg.append('circle')
                .attr('class', 'tail')
                .attr('cx', ptdata[ptdata.length - 10][0])
                .attr('cy', ptdata[ptdata.length - 10][1])
                .attr('r', tailRadius)
                .attr('fill', fill);
            tailData.push(new_circle);
            tailIndx.push(ptdata.length - 10);
            if (tailRadius > 0 && tailData.length % 7 == 0) {
                tailRadius--;
            }
        }

        function genSource(fill, pt) {
            var newSource = svg.append('circle')
                .attr('class', 'source')
                .attr('cx', pt[0])
                .attr('cy', pt[1])
                .attr('r', srcRadius)
                .attr('fill', fill)
                .on('mouseover', function() { 
                    addColor(newSource.attr('fill'));
                });
            return newSource;
        }
        


        svg.style('background-color', '#c7c7c7')
        genSource('#ffa3a3', [dimension/4, dimension/4]);
        genSource('#ffd5a9', [dimension/2, dimension/6]);
        genSource('#fbffb6', [dimension*3/4, dimension/4]);
        genSource('#bcffb6', [dimension*5/6, dimension/2]);
        genSource('#a5e2a2', [dimension*3/4, dimension*3/4]);
        genSource('#b4d7ff', [dimension/2, dimension*5/6]);
        genSource('#b0a0e5', [dimension/4, dimension*3/4]);
        genSource('#fcc3e3', [dimension/6, dimension/2]);
        
        // mouse movement
        d3.select("body").select("svg")
            .on("mousemove", function() {
                var pt = d3.mouse(this);
                cursor.attr('cx', pt[0]);
                cursor.attr('cy', pt[1]);
                tick(pt);
            });

        // click to reset
        var test = d3.select('body')
            .select('svg')
            .on('click', function() {
                tailRadius = 10;
                tailData = [];
                svg.selectAll('.tail').remove();
            });

		d3.timer(function(t) {
			sleep++;
			if (sleep > 1) {
				for (var i = 0; i < tailData.length; i++) {
					if (i == 0) {
						if (tailIndx[i] < ptdata.length - 1) {
							tailIndx[i]++;
						}
					} else {
						if (tailIndx[i] < tailIndx[i-1] - 1) {
							tailIndx[i]++;
						} else {
							tailIndx[i] = tailIndx[i-1] - 1;
						}
					}
					
	                tailData[i].attr('cx', ptdata[tailIndx[i]][0])
	                    .attr('cy', ptdata[tailIndx[i]][1]);
	            }
			}
			// console.log(sleep);
		});
        // YOUR CODE SHOULD END HERE
    </script>
</body>
</html>